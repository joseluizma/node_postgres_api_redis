################################## REDIS.CONF ##################################

# --- REDE & SEGURANÇA ---
# Em produção, nunca deixe 'bind 0.0.0.0' aberto para a internet.
# Como estamos no Docker, '0.0.0.0' é ok POIS o docker-compose controla as portas,
# mas idealmente feche via firewall.
bind 0.0.0.0

# Proteção: se não tiver senha e bind for público, ele bloqueia acessos externos.
protected-mode no

# Porta padrão
port 6379

# (Opcional) Defina uma senha forte se for expor o serviço
# requirepass SuaSenhaSuperForteAqui

# --- MEMÓRIA (CRÍTICO PARA CACHE) ---
# Define um teto de memória para o Redis não estourar a RAM do servidor e travar tudo.
# Ajuste conforme sua máquina (ex: 256mb para dev, 2gb+ para prod).
maxmemory 256mb

# O que fazer quando a memória encher?
# 'allkeys-lru': Apaga as chaves menos usadas recentemente (melhor para CACHE).
# 'volatile-lru': Apaga só as que têm expiração (TTL).
# 'noeviction': Retorna erro (ruim para cache, bom para banco de dados estrito).
maxmemory-policy allkeys-lru

# --- PERSISTÊNCIA (RDB + AOF) ---
# Estratégia Híbrida: Performance do RDB + Segurança do AOF.

# RDB (Snapshots): Salva o banco a cada X segundos se houver Y mudanças.
# Salva a cada 300 seg (5 min) se tiver pelo menos 10 mudanças.
save 300 10
# Salva a cada 60 seg se tiver 1000 mudanças.
save 60 1000

# AOF (Append Only File): Log de cada comando de escrita (mais seguro).
appendonly yes
# 'everysec': Sincroniza com o disco a cada segundo. Perda máxima de 1s de dados.
# É o melhor equilíbrio entre velocidade e segurança.
appendfsync everysec

# Otimização do AOF: Reescreve o log quando ele dobrar de tamanho (100%)
# e tiver no mínimo 64mb. Evita que o arquivo de log cresça infinitamente.
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# --- PERFORMANCE & CONEXÃO ---
# Número máximo de clientes simultâneos. Padrão é 10000.
maxclients 10000

# Fecha conexões inativas (idle) após 300 segundos (5 min) para liberar recursos.
timeout 0
# timeout 300
tcp-keepalive 300
